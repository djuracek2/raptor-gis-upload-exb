System.register(["jimu-core","jimu-arcgis","esri/widgets/FloorFilter"],(function(e,t){var i={},o={},r={};return{setters:[function(e){i.ClauseLogic=e.ClauseLogic,i.ClauseOperator=e.ClauseOperator,i.React=e.React,i.dataSourceUtils=e.dataSourceUtils,i.jsx=e.jsx},function(e){o.JimuMapViewComponent=e.JimuMapViewComponent},function(e){r.default=e.default}],execute:function(){e((()=>{var e={31504:(e,t,i)=>{"use strict";i.d(t,{Z:()=>l});var o=i(8081),r=i.n(o),n=i(23645),s=i.n(n)()(r());s.push([e.id,".widget-floorfilter{width:100%;height:100%}.widget-floorfilter-nomap{color:var(--dark-600);background-color:var(--light-200)}.widget-floorfilter-header{margin:10px 10px 5px;font-weight:bold}.widget-floorfilter-msg{padding:12px;height:48px}.widget-floorfilter-container{overflow-y:auto;height:100%}.widget-floorfilter .esri-floor-filter__zoom-button.esri-button--disabled{opacity:1}ul.esri-floor-filter__filter-menu-items>li>button.esri-floor-filter__filter-menu-site,ul.esri-floor-filter__filter-menu-items>li>button.esri-floor-filter__filter-menu-facility,.esri-floor-filter__filter-menu-header .esri-icon-close,.esri-floor-filter .esri-floor-filter__filter-menu .esri-floor-filter__filter-menu-header-back{color:var(--dark-600) !important}.esri-floor-filter .esri-floor-filter__button-container .esri-widget--button-active{color:var(--primary)}.esri-view-height-less-than-small .esri-floor-filter .esri-floor-filter__close-levels-button,.esri-view-width-less-than-medium .esri-floor-filter .esri-floor-filter__close-levels-button{background-color:var(--light-100) !important}",""]);const l=s},23645:e=>{"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var i="",o=void 0!==t[5];return t[4]&&(i+="@supports (".concat(t[4],") {")),t[2]&&(i+="@media ".concat(t[2]," {")),o&&(i+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),i+=e(t),o&&(i+="}"),t[2]&&(i+="}"),t[4]&&(i+="}"),i})).join("")},t.i=function(e,i,o,r,n){"string"==typeof e&&(e=[[null,e,void 0]]);var s={};if(o)for(var l=0;l<this.length;l++){var a=this[l][0];null!=a&&(s[a]=!0)}for(var d=0;d<e.length;d++){var c=[].concat(e[d]);o&&s[c[0]]||(void 0!==n&&(void 0===c[5]||(c[1]="@layer".concat(c[5].length>0?" ".concat(c[5]):""," {").concat(c[1],"}")),c[5]=n),i&&(c[2]?(c[1]="@media ".concat(c[2]," {").concat(c[1],"}"),c[2]=i):c[2]=i),r&&(c[4]?(c[1]="@supports (".concat(c[4],") {").concat(c[1],"}"),c[4]=r):c[4]="".concat(r)),t.push(c))}},t}},8081:e=>{"use strict";e.exports=function(e){return e[1]}},93379:e=>{"use strict";var t=[];function i(e){for(var i=-1,o=0;o<t.length;o++)if(t[o].identifier===e){i=o;break}return i}function o(e,o){for(var n={},s=[],l=0;l<e.length;l++){var a=e[l],d=o.base?a[0]+o.base:a[0],c=n[d]||0,u="".concat(d," ").concat(c);n[d]=c+1;var f=i(u),p={css:a[1],media:a[2],sourceMap:a[3],supports:a[4],layer:a[5]};if(-1!==f)t[f].references++,t[f].updater(p);else{var h=r(p,o);o.byIndex=l,t.splice(l,0,{identifier:u,updater:h,references:1})}s.push(u)}return s}function r(e,t){var i=t.domAPI(t);return i.update(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap&&t.supports===e.supports&&t.layer===e.layer)return;i.update(e=t)}else i.remove()}}e.exports=function(e,r){var n=o(e=e||[],r=r||{});return function(e){e=e||[];for(var s=0;s<n.length;s++){var l=i(n[s]);t[l].references--}for(var a=o(e,r),d=0;d<n.length;d++){var c=i(n[d]);0===t[c].references&&(t[c].updater(),t.splice(c,1))}n=a}}},90569:e=>{"use strict";var t={};e.exports=function(e,i){var o=function(e){if(void 0===t[e]){var i=document.querySelector(e);if(window.HTMLIFrameElement&&i instanceof window.HTMLIFrameElement)try{i=i.contentDocument.head}catch(e){i=null}t[e]=i}return t[e]}(e);if(!o)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");o.appendChild(i)}},19216:e=>{"use strict";e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},3565:(e,t,i)=>{"use strict";e.exports=function(e){var t=i.nc;t&&e.setAttribute("nonce",t)}},7795:e=>{"use strict";e.exports=function(e){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var t=e.insertStyleElement(e);return{update:function(i){!function(e,t,i){var o="";i.supports&&(o+="@supports (".concat(i.supports,") {")),i.media&&(o+="@media ".concat(i.media," {"));var r=void 0!==i.layer;r&&(o+="@layer".concat(i.layer.length>0?" ".concat(i.layer):""," {")),o+=i.css,r&&(o+="}"),i.media&&(o+="}"),i.supports&&(o+="}");var n=i.sourceMap;n&&"undefined"!=typeof btoa&&(o+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(n))))," */")),t.styleTagTransform(o,e,t.options)}(t,e,i)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}},44589:e=>{"use strict";e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}},62830:e=>{"use strict";e.exports=r},26826:e=>{"use strict";e.exports=o},48891:e=>{"use strict";e.exports=i}},t={};function n(i){var o=t[i];if(void 0!==o)return o.exports;var r=t[i]={id:i,exports:{}};return e[i](r,r.exports,n),r.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var i in t)n.o(t,i)&&!n.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.p="",n.nc=void 0;var s={};return n.p=window.jimuConfig.baseUrl,(()=>{"use strict";n.r(s),n.d(s,{__set_webpack_public_path__:()=>x,default:()=>M});var e=n(48891);const t={_widgetLabel:"Floor Filter",floorfilter_noMap:"Floor Filter",floorfilter_notFloorAware:"The selected map is not floor aware"};var i=n(26826);class o{constructor(){this.filterToActiveLevel=!1}clear(){try{this.ffLevelHandle&&this.ffLevelHandle.remove()}catch(e){console.error(e)}finally{this.ffLevelHandle=null}this.jimuMapView&&this.filterToActiveLevel&&this.updateDataSources(this.jimuMapView,this.widgetId,null)}init(e,t,i){var o,r,n;this.clear(),this.jimuMapView=e;const s=this.widgetId=null===(o=null==t?void 0:t.props)||void 0===o?void 0:o.id,l=this.filterToActiveLevel=!!(null===(n=null===(r=null==t?void 0:t.props)||void 0===r?void 0:r.config)||void 0===n?void 0:n.filterDataSources);e&&i&&l&&(this.ffLevelHandle=i.watch("level",(t=>{this.updateDataSources(e,s,t)})),e.whenAllJimuLayerViewLoaded().then((()=>{if(e===this.jimuMapView){const t=i.level;this.updateDataSources(e,s,t)}})))}updateDataSources(t,i,o){var r,n,s,l,a;"string"==typeof o&&o.startsWith("all--")&&(o=null);const d=null===(s=null===(n=null===(r=null==t?void 0:t.view)||void 0===r?void 0:r.map)||void 0===n?void 0:n.floorInfo)||void 0===s?void 0:s.levelLayer;let c,u;d&&d.layerId&&(c=null===(a=null===(l=null==t?void 0:t.view)||void 0===l?void 0:l.map)||void 0===a?void 0:a.findLayerById(d.layerId),c&&"number"==typeof d.sublayerId&&(u=c.findSublayerById(d.sublayerId)));const f=t=>{return r=this,n=void 0,l=function*(){var r,n,s;const l=null==t?void 0:t.getLayerDataSource();if(l&&!(e=>{const t=null==e?void 0:e.layer;if(d&&d.layerId)if("number"==typeof d.sublayerId){if(u&&u===t)return!0}else if(c&&c===t)return!0;return!1})(t)){const a=null==l?void 0:l.layer,d=null==t?void 0:t.layer;(null===(r=null==d?void 0:d.floorInfo)||void 0===r?void 0:r.floorField)&&"function"==typeof d.when&&"loading"===d.loadStatus&&(yield d.when());let c=(null===(n=null==a?void 0:a.floorInfo)||void 0===n?void 0:n.floorField)||(null===(s=null==d?void 0:d.floorInfo)||void 0===s?void 0:s.floorField);if(c&&a&&("feature"===a.type||"scene"===a.type)){c=((e,t)=>{let i=t;if(t&&e&&e.length>0){const o=t.toLowerCase();e.some((e=>o===e.name.toLowerCase()&&(i=e.name,!0)))}return i})(a.fields,c);const t=l,r=((t,i)=>{let r=null;if(o){const n=e.dataSourceUtils.createSQLClause(t,e.ClauseOperator.StringOperatorIs,[{value:o,label:o+""}]),s=e.dataSourceUtils.createSQLExpression(e.ClauseLogic.Or,[n],i);r={where:s.sql,sqlExpression:s}}else r={where:"1=1",sqlExpression:null};return r})(c,t);r&&t.updateQueryParams(r,i)}}},new((s=void 0)||(s=Promise))((function(e,t){function i(e){try{a(l.next(e))}catch(e){t(e)}}function o(e){try{a(l.throw(e))}catch(e){t(e)}}function a(t){var r;t.done?e(t.value):(r=t.value,r instanceof s?r:new s((function(e){e(r)}))).then(i,o)}a((l=l.apply(r,n||[])).next())}));var r,n,s,l};t&&t.jimuLayerViews&&Object.keys(t.jimuLayerViews).forEach((e=>{f(t.jimuLayerViews[e])}))}}var r=n(62830),l=n(93379),a=n.n(l),d=n(7795),c=n.n(d),u=n(90569),f=n.n(u),p=n(3565),h=n.n(p),v=n(19216),m=n.n(v),g=n(44589),w=n.n(g),y=n(31504),b={};b.styleTagTransform=w(),b.setAttributes=h(),b.insert=f().bind(null,"head"),b.domAPI=c(),b.insertStyleElement=m(),a()(y.Z,b),y.Z&&y.Z.locals&&y.Z.locals;class M extends e.React.PureComponent{constructor(e){super(e),this.clearHandles=e=>{Array.isArray(e)&&e.forEach((e=>{try{e&&e.remove()}catch(e){console.error(e)}}))},this.handleActiveViewChange=e=>{var t;this.setState({hadMap:!(!this.state.hadMap&&!(null===(t=null==e?void 0:e.view)||void 0===t?void 0:t.map)),jimuMapView:e})},this.hasFloorInfo=()=>{var e,t,i;return!!(null===(i=null===(t=null===(e=this.state.jimuMapView)||void 0===e?void 0:e.view)||void 0===t?void 0:t.map)||void 0===i?void 0:i.floorInfo)},this.hasMap=()=>{var e,t;return!!(null===(t=null===(e=this.state.jimuMapView)||void 0===e?void 0:e.view)||void 0===t?void 0:t.map)},this.nls=(e,i)=>this.props.intl?this.props.intl.formatMessage({id:e,defaultMessage:t[e]},i):e,this.dsFilter=new o,this.state={hadMap:!1,jimuMapView:null,wasMounted:!1}}componentDidMount(){this.setState({wasMounted:!0})}componentDidUpdate(e,t){const i=this.state,o=this.props;i.wasMounted&&!t.wasMounted?this.loadCoreWidget():i.jimuMapView!==t.jimuMapView||o.config.filterDataSources!==e.config.filterDataSources?i.wasMounted&&this.loadCoreWidget():o.config.longNames!==e.config.longNames?this.coreWidget&&(this.coreWidget.longNames=!!o.config.longNames):o.config.position!==e.config.position&&this.coreWidget&&this.coreWidget.scheduleRender()}componentWillUnmount(){this.destroyCoreWidget()}destroyCoreWidget(){if(this.dsFilter.clear(),this.coreWidget){const e=this.coreWidget.view;this.coreWidget.destroy(),this.coreWidget=null,e&&(e.floors=this.vwOriginalFloors||null)}this.vwHeightHandle&&(this.clearHandles([this.vwHeightHandle]),this.vwHeightHandle=null),this.vwWidthHandle&&(this.clearHandles([this.vwWidthHandle]),this.vwWidthHandle=null)}fixBreakpoints(e){setTimeout((()=>{var t;const i=null===(t=this.coreWidget)||void 0===t?void 0:t.viewModel;let o="large";try{document.documentElement.classList.contains("size-mode-MEDIUM")?o="medium":document.documentElement.classList.contains("size-mode-SMALL")&&(o="xsmall")}catch(e){console.error(e)}!i||"both"!==e&&"widthBreakpoint"!==e||(i._viewWidthBreakpoint=o),!i||"both"!==e&&"heightBreakpoint"!==e||(i._viewHeightBreakpoint=o)}),100)}loadCoreWidget(){if(this.coreContainer)if(this.hasFloorInfo()){this.destroyCoreWidget();const e=document.createElement("div");this.coreContainer.appendChild(e);const t=!!this.props.config.longNames,i=this.state.jimuMapView.view;this.coreWidget=new r.default({container:e,longNames:t,view:i}),this.dsFilter.init(this.state.jimuMapView,this,this.coreWidget),this.coreWidget._getComponentPosition=()=>this.props.config.position||"top-left",this.vwOriginalFloors=i.floors&&i.floors.clone(),this.fixBreakpoints("both"),this.vwWidthHandle=i.watch("widthBreakpoint",(()=>{this.fixBreakpoints("widthBreakpoint")})),this.vwHeightHandle=i.watch("heightBreakpoint",(()=>{this.fixBreakpoints("heightBreakpoint")}))}else this.destroyCoreWidget()}render(){var t;const o=this.props.config.displayLabel?this.props.label:null,r=this.hasMap(),n=this.hasFloorInfo();let s;r?n||(s=this.nls("floorfilter_notFloorAware")):s=this.nls("floorfilter_noMap");let l="jimu-widget widget-floorfilter";return s&&(l+=" widget-floorfilter-nomap"),(0,e.jsx)("div",{className:l},(0,e.jsx)("h4",{className:"widget-floorfilter-header",style:{display:o?"block":"none"}},o),(0,e.jsx)("div",{className:"widget-floorfilter-msg",style:{display:s?"block":"none"}},(0,e.jsx)("span",{className:"esri-icon esri-icon-urban-model"}),(0,e.jsx)("span",{style:{margin:"0 8px"}},s)),(0,e.jsx)("div",{className:"widget-floorfilter-container",ref:e=>{this.coreContainer=e}}),(0,e.jsx)(i.JimuMapViewComponent,{useMapWidgetId:null===(t=this.props.useMapWidgetIds)||void 0===t?void 0:t[0],onActiveViewChange:this.handleActiveViewChange}))}}function x(e){n.p=e}})(),s})())}}}));