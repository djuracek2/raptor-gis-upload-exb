define(["exports","./index2-5ec30cf6","./shared-components-56ff786d","./store-c935607a","./analysis-tool-context-b1931181"],(function(e,t,a,s,n){"use strict";const i=t.proxyCustomElement(class extends t.H{constructor(){super(),this.__registerHost(),this.__attachShadow(),this.analysisToolStandardSettingsHelpClick=t.createEvent(this,"analysisToolStandardSettingsHelpClick",7),this.mapExtentInputs=[],this.stateContextChanged=!1,this.setIncomingLayerObjects=async()=>{const e={};s.state.settingsSelectedExtentOption===a.ExtentOptions.Layer&&void 0!==s.state.mapLevelContext.extentLayer&&(e.extentLayer=await t.getLayer(s.state.mapLevelContext.extentLayer,s.state.mapLayers)),s.state.settingsSelectedOutSpatialRefOption===a.OutSROptions.SameAsLayer&&void 0!==s.state.mapLevelContext.spatialRefLayer&&(e.spatialRefLayer=await t.getLayer(s.state.mapLevelContext.spatialRefLayer,s.state.mapLayers)),this.incomingLayerObjects=e},this.handleExtentChange=(e,t)=>{s.set(s.state.context,["extent",e],t);const a=s.state.context.extent;void 0!==s.state.mapView?.spatialReference&&(a.spatialReference=s.state.mapView.spatialReference,s.state.context.extent=this.getContextExtent(a)),s.state.context={...s.state.context}},this.handleCalciteListChange=async e=>{const[t]=(await(e.target?.getSelectedItems())).values();s.state.settingsSelectedExtentOption=t.value,this.incomingLayerObjects.extentLayer=void 0,this.extentPopover?.remove()},this.setMapExtent=()=>{void 0!==s.state.mapView&&(s.state.context.extent=this.getContextExtent(s.state.mapView.extent)),s.state.context={...s.state.context},this.stateContextChanged=!0},this.handleLayerInputClose=e=>{"extent"===e?(delete s.state.context.extent,this.incomingLayerObjects.extentLayer=void 0):"spatialReference"===e&&(delete s.state.context.outSR,this.incomingLayerObjects.spatialRefLayer=void 0),this.incomingLayerObjects={...this.incomingLayerObjects},s.state.context={...s.state.context}},this.handleLayerInputChange=(e,a)=>{const n=e.target?.selectedLayers;if("extent"===a&&void 0!==n?.fullExtent)s.state.context.extent=this.getContextExtent(n.fullExtent);else if(void 0!==n&&"spatialReference"in n){const{wkid:e,latestWkid:a,wkt:i}=n?.spatialReference;t.isEmptyDataItem(e)||s.set(s.state.context,"outSR.wkid",e),t.isEmptyDataItem(a)||s.set(s.state.context,"outSR.latestWkid",a),t.isEmptyDataItem(i)||s.set(s.state.context,"outSR.wkt",i)}s.state.context={...s.state.context}},this.createExtentPopover=e=>{this.extentPopover?.remove(),this.extentPopover=document.createElement("calcite-popover");const t={autoClose:!0,dir:this.dir,focusTrapDisabled:!0,heading:this.strings.processingExtent,closable:!0,open:!0,referenceElement:e.target};Object.assign(this.extentPopover,t),this.extentPopover.addEventListener("calcitePopoverClose",this.extentPopover?.remove);const n=document.createElement("calcite-pick-list");n.addEventListener("calciteListChange",this.handleCalciteListChange);const i=[{label:this.strings.default,description:this.strings.defaultText,value:a.ExtentOptions.Default},{label:this.strings.coordinates,description:this.strings.coordinatesText,value:a.ExtentOptions.Coordinates},{label:this.strings.mapExtent,description:this.strings.mapExtentText,value:a.ExtentOptions.MapExtent},{label:this.strings.layer,description:this.strings.layerText,value:a.ExtentOptions.Layer}].map((e=>{const t=document.createElement("calcite-pick-list-item");return Object.assign(t,e),t.selected=t.value===s.state.settingsSelectedExtentOption,t}));n.append(...i),this.extentPopover.append(n),document.body.append(this.extentPopover),setTimeout((()=>requestAnimationFrame((()=>this.extentPopover?.setFocus()))),1)},this.handleSpatialReferenceChange=e=>{s.state.context.outSR={latestWkid:e.detail.latestWkid}},this.hideOutSR=!1,this.hideCategories=["Vertical Coordinate Systems"],this.hideExtent=!1,this.incomingLayerObjects={}}async resetLayerDefaults(){return this.setIncomingLayerObjects(),Promise.resolve()}async validateStandardSettings(){let e=!0,t=!0;switch(s.state.settingsSelectedExtentOption){case a.ExtentOptions.Layer:const t=this.hostElement.shadowRoot?.querySelector(".extent");null!=t&&(e=await t.checkValidity());break;case a.ExtentOptions.Coordinates:const s=this.hostElement.shadowRoot?.querySelectorAll("analysis-number-input"),n=[];null!=s&&(s.forEach((e=>{n.push(e.checkValidity())})),e=!(await Promise.all(n)).some((e=>!1===e)))}switch(s.state.settingsSelectedOutSpatialRefOption){case a.OutSROptions.SameAsLayer:const e=this.hostElement.shadowRoot?.querySelector(".spatialReference");null!=e&&(t=await e.checkValidity());break;case a.OutSROptions.BrowseCS:const s=this.hostElement.shadowRoot?.querySelector("analysis-spatial-reference-input");null!=s&&(t=await s.checkValidity())}return Promise.resolve(t&&e)}async componentWillLoad(){this.setIncomingLayerObjects(),({strings:this.strings,dir:this.dir}=await t.fetchComponentLocaleStrings(this.hostElement,t.getAssetPath(".")))}componentDidRender(){this.stateContextChanged&&(setTimeout((()=>requestAnimationFrame((()=>this.mapExtentInputs?.forEach((e=>e.checkValidity()))))),1),this.stateContextChanged=!1)}disconnectedCallback(){this.extentPopover?.remove(),this.coordinateSystemPopover?.remove()}renderCoordinateConfig(){const{strings:e}=this,{extent:n}=s.state.context;return t.h("div",null,t.h("calcite-button",{class:a.SharedHTMLClasses.controlSpacing,scale:a.UIDefaults.Scale,appearance:"outline",kind:"neutral",width:"full",onClick:this.setMapExtent},e.setCoordinates),t.h("calcite-label",null,e.top,t.h("analysis-number-input",{ref:e=>{this.mapExtentInputs.push(e)},required:!0,label:"",value:n?.ymax,scale:a.UIDefaults.Scale,onAnalysisNumberInputChange:e=>this.handleExtentChange("ymax",e.target?.value)})),t.h("calcite-label",null,e.bottom,t.h("analysis-number-input",{ref:e=>{this.mapExtentInputs.push(e)},required:!0,label:"",value:n?.ymin,scale:a.UIDefaults.Scale,onAnalysisNumberInputChange:e=>this.handleExtentChange("ymin",e.target?.value)})),t.h("calcite-label",null,e.left,t.h("analysis-number-input",{ref:e=>{this.mapExtentInputs.push(e)},required:!0,label:"",value:n?.xmin,scale:a.UIDefaults.Scale,onAnalysisNumberInputChange:e=>this.handleExtentChange("xmin",e.target?.value)})),t.h("calcite-label",null,e.right,t.h("analysis-number-input",{ref:e=>{this.mapExtentInputs.push(e)},required:!0,label:"",value:n?.xmax,scale:a.UIDefaults.Scale,onAnalysisNumberInputChange:e=>this.handleExtentChange("xmax",e.target?.value)})))}renderLayerInput(e){let a;const i=s.state.mapLayers;if("extent"===e?a=this.incomingLayerObjects?.extentLayer:"spatialReference"===e&&(a=this.incomingLayerObjects?.spatialRefLayer),void 0!==a){let e;if(!1===t.isEmptyDataItem(a.url)){const t="layerId"in a?a.layerId:0;e=`${a.url}/${t}`}else e=a.title;void 0===t.findExistingLayer(e,s.state.mapLayers)&&i.push(a)}return t.h("analysis-layer-input",{class:e,required:!0,descriptionDisplay:"spatialReference",mapLayers:i,layerFilterType:[n.LayerFilterType.Imagery_All,n.LayerFilterType.Feature_All],selectedLayers:a,user:s.state.portal?.user,mapView:s.state.mapView,onAnalysisLayerInputClose:()=>this.handleLayerInputClose(e),onAnalysisLayerInputChange:t=>this.handleLayerInputChange(t,e)})}renderChooseSpatialReference(){const e=s.state.context.outSR?.latestWkid??s.state.context.outSR?.wkid;return t.h("analysis-spatial-reference-input",{errorMessage:void 0!==s.state.context.outSR?.wkt&&void 0===e?this.strings.unableToRepopulateOutSR:void 0,dir:this.dir,required:!0,onAnalysisSpatialReferenceInputChange:e=>this.handleSpatialReferenceChange(e),value:void 0!==e?{latestWkid:e}:void 0,hideCategories:this.hideCategories})}renderOutSR(){const{strings:e}=this;return t.h("div",null,t.h("analysis-label",{label:e.outputCS,onAnalysisLabelHelpActionClick:t=>this.analysisToolStandardSettingsHelpClick.emit({key:n.AnalysisToolContextKeys.OutSR,parameterName:e.outputCS,refElement:t.target})}),t.h("calcite-dropdown",{class:`display-block ${a.SharedHTMLClasses.controlSpacing}`,placement:"bottom",scale:a.UIDefaults.Scale},t.h("calcite-button",{class:a.SharedHTMLClasses.analysisBorder,alignment:"space-between",appearance:"transparent",kind:"neutral","icon-end":"chevron-down",scale:a.UIDefaults.Scale,slot:"trigger",width:"full"},e[s.state.settingsSelectedOutSpatialRefOption]),t.h("calcite-dropdown-group",null,t.h("calcite-dropdown-item",{onClick:()=>{s.state.settingsSelectedOutSpatialRefOption=a.OutSROptions.SameAsInput,this.incomingLayerObjects.spatialRefLayer=void 0}},e.sameAsInput),t.h("calcite-dropdown-item",{onClick:()=>{s.state.settingsSelectedOutSpatialRefOption=a.OutSROptions.BrowseCS,this.incomingLayerObjects.spatialRefLayer=void 0}},e.browseCS),t.h("calcite-dropdown-item",{onClick:()=>{s.state.settingsSelectedOutSpatialRefOption=a.OutSROptions.SameAsLayer,this.incomingLayerObjects.spatialRefLayer=void 0}},e.sameAsLayer))),s.state.settingsSelectedOutSpatialRefOption===a.OutSROptions.SameAsLayer&&this.renderLayerInput("spatialReference"),s.state.settingsSelectedOutSpatialRefOption===a.OutSROptions.BrowseCS&&this.renderChooseSpatialReference())}renderExtent(){const{strings:e}=this,{settingsSelectedExtentOption:i}=s.state;return t.h("div",null,t.h("analysis-label",{label:e.processingExtent,onAnalysisLabelHelpActionClick:t=>this.analysisToolStandardSettingsHelpClick.emit({key:n.AnalysisToolContextKeys.Extent,parameterName:e.processingExtent,refElement:t.target})}),t.h("calcite-value-list-item",{class:[a.SharedHTMLClasses.controlSpacing,a.SharedHTMLClasses.analysisBorder].join(" "),label:e[i],description:e[`${i}Text`],value:i,onClick:e=>this.createExtentPopover(e)},t.h("calcite-action",{slot:"actions-end",icon:"chevron-down",text:""})),i===a.ExtentOptions.Coordinates&&this.renderCoordinateConfig(),i===a.ExtentOptions.Layer&&this.renderLayerInput("extent"))}render(){return t.h(t.Host,null,!this.hideOutSR&&this.renderOutSR(),!this.hideExtent&&this.renderExtent())}getContextExtent(e){const{xmin:a,ymin:n,xmax:i,ymax:l,spatialReference:o}=e,{wkid:r,latestWkid:c,wkt:p}=o,d={xmin:a,ymin:n,xmax:i,ymax:l};return t.isEmptyDataItem(r)||s.set(d,"spatialReference.wkid",r),t.isEmptyDataItem(c)||s.set(d,"spatialReference.latestWkid",c),t.isEmptyDataItem(p)||s.set(d,"spatialReference.wkt",p),d}static get assetsDirs(){return["t9n"]}get hostElement(){return this}static get style(){return":root{display:flex}.control-spacing{margin-bottom:var(--analysis-three-quarter-spacing)}.label-container{display:flex;margin-bottom:var(--analysis-quarter-spacing);gap:var(--analysis-quarter-spacing)}.analysis-border{border:1px solid var(--analysis-ui-border-input)}.notice-margin-global{margin:var(--analysis-full-spacing) var(--analysis-three-quarter-spacing)}:host{display:flex;flex-direction:column}.control-spacing{width:100%}.display-block{display:block}"}},[1,"analysis-tool-standard-settings",{hideOutSR:[516,"hide-out-s-r"],hideCategories:[16],hideExtent:[516,"hide-extent"],incomingLayerObjects:[32],resetLayerDefaults:[64],validateStandardSettings:[64]}]);function l(){"undefined"!=typeof customElements&&["analysis-tool-standard-settings"].forEach((e=>{"analysis-tool-standard-settings"===e&&(customElements.get(e)||customElements.define(e,i))}))}l(),e.AnalysisToolStandardSettings=i,e.defineCustomElement=l}));